<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Donald Duck Pockets Collection</title>
    <link href="https://fonts.googleapis.com/css2?family=Bangers&family=Patrick+Hand&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #7DD3FC;
            --secondary: #0284C7;
            --accent: #0369A1;
            --bg: #E0F2FE;
            --card-bg: #FFFFFF;
            --text: #0C4A6E;
            --shadow: rgba(2, 132, 199, 0.15);
            --check-green: #06D6A0;
        }

        /* Theme colors for different collections */
        body.regular {
            --primary: #7DD3FC;
            --secondary: #0284C7;
            --accent: #0369A1;
            --bg: #E0F2FE;
        }

        body.dubbel {
            --primary: #FCA5A5;
            --secondary: #DC2626;
            --accent: #991B1B;
            --bg: #FEE2E2;
        }

        body.thema {
            --primary: #D1D5DB;
            --secondary: #374151;
            --accent: #1F2937;
            --bg: #F3F4F6;
        }

        body.classics {
            --primary: #FDE047;
            --secondary: #CA8A04;
            --accent: #854D0E;
            --bg: #FEF9C3;
        }

        body.duckburg {
            --primary: #F87171;
            --secondary: #7F1D1D;
            --accent: #450A0A;
            --bg: #FEE2E2;
        }

        body.wereldreis {
            --primary: #86EFAC;
            --secondary: #16A34A;
            --accent: #166534;
            --bg: #DCFCE7;
        }

        body.fantasy {
            --primary: #A3E635;
            --secondary: #4D7C0F;
            --accent: #365314;
            --bg: #ECFCCB;
        }

        body.galaxy {
            --primary: #60A5FA;
            --secondary: #1E3A8A;
            --accent: #1E40AF;
            --bg: #DBEAFE;
        }

        body.premium {
            --primary: #A8A29E;
            --secondary: #1C1917;
            --accent: #0C0A09;
            --bg: #E7E5E4;
        }

        body.history {
            --primary: #D4A574;
            --secondary: #78350F;
            --accent: #451A03;
            --bg: #FED7AA;
        }

        body.duckstad {
            --primary: #E5E7EB;
            --secondary: #4B5563;
            --accent: #1F2937;
            --bg: #F9FAFB;
        }

        body.mini {
            --primary: #FDBA74;
            --secondary: #EA580C;
            --accent: #9A3412;
            --bg: #FFEDD5;
        }

        body.mega {
            --primary: #C084FC;
            --secondary: #7C3AED;
            --accent: #5B21B6;
            --bg: #F3E8FF;
        }

        body {
            font-family: 'Patrick Hand', cursive;
            background: linear-gradient(135deg, var(--bg) 0%, var(--primary) 100%);
            min-height: 100vh;
            padding: 2rem 1rem;
            background-attachment: fixed;
            position: relative;
            overflow-x: hidden;
            transition: background 0.5s ease;
        }

        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-image: 
                radial-gradient(circle at 20% 30%, var(--primary) 0%, transparent 50%),
                radial-gradient(circle at 80% 70%, var(--secondary) 0%, transparent 50%);
            opacity: 0.15;
            pointer-events: none;
            z-index: 0;
            transition: background 0.5s ease;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            position: relative;
            z-index: 1;
        }

        header {
            text-align: center;
            margin-bottom: 2rem;
            animation: slideDown 0.8s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-50px) rotate(-5deg);
            }
            to {
                opacity: 1;
                transform: translateY(0) rotate(0deg);
            }
        }

        header img {
            max-width: 100%;
            height: auto;
            max-height: 150px;
            margin: 0 auto;
            display: block;
        }

        .collection-nav {
            display: flex;
            flex-direction: row;
            align-items: center;
            justify-content: center;
            gap: 2rem;
            margin: 2rem 0;
            flex-wrap: wrap;
        }

        .collection-title {
            order: 2;
        }

        .nav-arrow:first-of-type {
            order: 1;
        }

        .nav-arrow:last-of-type {
            order: 3;
        }

        @media (max-width: 768px) {
            .collection-nav {
                flex-direction: row;
                gap: 1rem;
            }
            
            .collection-title {
                order: 1;
                width: 100%;
                text-align: center;
            }
            
            .nav-arrow:first-of-type {
                order: 2;
            }
            
            .nav-arrow:last-of-type {
                order: 3;
            }
        }

        .nav-arrow {
            font-family: 'Bangers', cursive;
            font-size: 3rem;
            background: var(--card-bg);
            border: 4px solid var(--secondary);
            border-radius: 50%;
            width: 70px;
            height: 70px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 5px 5px 0px var(--secondary);
            color: var(--secondary);
        }

        .nav-arrow:hover {
            transform: scale(1.1) rotate(5deg);
            box-shadow: 8px 8px 0px var(--secondary);
        }

        .collection-title {
            font-family: 'Bangers', cursive;
            font-size: clamp(2rem, 6vw, 3.5rem);
            color: var(--secondary);
            text-shadow: 3px 3px 0px var(--primary);
            letter-spacing: 2px;
            padding: 1rem 2rem;
            background: var(--card-bg);
            border: 4px solid var(--secondary);
            border-radius: 20px;
            box-shadow: 6px 6px 0px var(--secondary);
        }

        .stats {
            display: flex;
            justify-content: center;
            gap: 2rem;
            margin: 2rem 0;
            flex-wrap: wrap;
        }

        .stat-box {
            background: var(--card-bg);
            padding: 1rem 2rem;
            border-radius: 15px;
            border: 3px solid var(--secondary);
            box-shadow: 5px 5px 0px var(--secondary);
            transform: rotate(-1deg);
            transition: all 0.3s ease;
        }

        .stat-box:hover {
            transform: rotate(0deg) scale(1.05);
        }

        .stat-box.checked {
            transform: rotate(1deg);
        }

        .stat-box.buy-cheap {
            transform: rotate(-1deg);
        }

        .stat-number {
            font-family: 'Bangers', cursive;
            font-size: 2.5rem;
            color: var(--accent);
            display: block;
        }

        .stat-label {
            font-size: 1rem;
            color: var(--text);
            text-transform: uppercase;
        }

        .jump-container {
            text-align: center;
            margin: 2rem 0;
        }

        .jump-box {
            display: inline-block;
            background: var(--card-bg);
            padding: 1rem 2rem;
            border-radius: 15px;
            border: 3px solid var(--secondary);
            box-shadow: 5px 5px 0px var(--secondary);
        }

        .jump-input {
            font-family: 'Patrick Hand', cursive;
            font-size: 1.2rem;
            padding: 0.5rem 1rem;
            border: 3px solid var(--secondary);
            border-radius: 10px;
            width: 150px;
        }

        .jump-button {
            font-family: 'Patrick Hand', cursive;
            font-size: 1.2rem;
            padding: 0.5rem 1.5rem;
            background: var(--primary);
            color: var(--text);
            border: 3px solid var(--secondary);
            border-radius: 10px;
            cursor: pointer;
            margin-left: 0.5rem;
            font-weight: bold;
            box-shadow: 3px 3px 0px var(--secondary);
            transition: all 0.3s ease;
        }

        .jump-button:hover {
            transform: translateY(-3px);
            box-shadow: 5px 5px 0px var(--secondary);
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 2rem;
            margin-top: 2rem;
        }

        .pocket-card {
            background: var(--card-bg);
            border-radius: 20px;
            padding: 1.5rem;
            border: 4px solid var(--secondary);
            box-shadow: 6px 6px 0px var(--shadow);
            transition: all 0.3s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            position: relative;
            opacity: 0;
            animation: fadeInUp 0.6s ease forwards;
            cursor: pointer;
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px) rotate(-3deg);
            }
            to {
                opacity: 1;
                transform: translateY(0) rotate(0deg);
            }
        }

        .pocket-card:hover {
            transform: translateY(-10px) rotate(2deg);
            box-shadow: 10px 10px 0px var(--shadow);
        }

        .pocket-card.checked {
            background: linear-gradient(135deg, var(--bg) 0%, var(--primary) 100%);
            border-color: var(--check-green);
        }

        .pocket-card.buy-cheap {
            background: linear-gradient(135deg, #FEF3C7 0%, #FDE68A 100%);
            border-color: #F59E0B;
        }

        .pocket-card.checked::before {
            content: '‚úì';
            position: absolute;
            top: -15px;
            right: -15px;
            width: 50px;
            height: 50px;
            background: var(--check-green);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-family: 'Bangers', cursive;
            font-size: 2rem;
            color: white;
            border: 4px solid var(--secondary);
            transform: rotate(15deg);
            animation: checkPop 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }

        .pocket-card.buy-cheap::before {
            content: '$';
            position: absolute;
            top: -15px;
            right: -15px;
            width: 50px;
            height: 50px;
            background: #F59E0B;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-family: 'Bangers', cursive;
            font-size: 2rem;
            color: white;
            border: 4px solid var(--secondary);
            transform: rotate(15deg);
            animation: checkPop 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }

        @keyframes checkPop {
            0% {
                transform: scale(0) rotate(15deg);
            }
            50% {
                transform: scale(1.2) rotate(15deg);
            }
            100% {
                transform: scale(1) rotate(15deg);
            }
        }

        .image-container {
            width: 100%;
            height: 250px;
            background: var(--bg);
            border-radius: 12px;
            overflow: hidden;
            border: 3px solid var(--secondary);
            margin-bottom: 1rem;
            position: relative;
        }

        .pocket-image {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.3s ease;
        }

        .pocket-card:hover .pocket-image {
            transform: scale(1.1) rotate(-2deg);
        }

        .placeholder-image {
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-family: 'Bangers', cursive;
            font-size: 3rem;
            color: var(--secondary);
            background: linear-gradient(45deg, var(--primary) 0%, var(--bg) 100%);
        }

        .pocket-title {
            font-family: 'Bangers', cursive;
            font-size: 1.5rem;
            color: var(--secondary);
            margin-bottom: 0.8rem;
            text-align: center;
            letter-spacing: 1px;
        }

        .checkbox-container {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            margin-top: 1rem;
        }

        .custom-checkbox {
            width: 35px;
            height: 35px;
            border: 4px solid var(--secondary);
            border-radius: 8px;
            background: white;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            font-family: 'Bangers', cursive;
            font-size: 1.8rem;
            color: var(--check-green);
        }

        .custom-checkbox:hover {
            transform: scale(1.1) rotate(5deg);
            background: var(--primary);
        }

        .checkbox-label {
            font-size: 1.2rem;
            color: var(--text);
            font-weight: bold;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            animation: fadeIn 0.5s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: var(--card-bg);
            padding: 2rem;
            border-radius: 20px;
            border: 5px solid var(--secondary);
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
            text-align: center;
            max-width: 400px;
            animation: modalPop 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }

        @keyframes modalPop {
            0% {
                transform: scale(0.5) rotate(-10deg);
            }
            100% {
                transform: scale(1) rotate(0deg);
            }
        }

        .modal-title {
            font-family: 'Bangers', cursive;
            font-size: 2rem;
            color: var(--secondary);
            margin-bottom: 1rem;
        }

        .modal-text {
            font-size: 1.2rem;
            color: var(--text);
            margin-bottom: 1.5rem;
        }

        .modal-buttons {
            display: flex;
            gap: 1rem;
            justify-content: center;
            flex-direction: column;
        }

        .btn {
            font-family: 'Patrick Hand', cursive;
            font-size: 1.2rem;
            padding: 0.8rem 2rem;
            border: 3px solid var(--secondary);
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: bold;
            width: 100%;
        }

        .btn-confirm {
            background: var(--check-green);
            color: white;
            box-shadow: 4px 4px 0px var(--secondary);
        }

        .btn-confirm:hover {
            transform: translateY(-3px);
            box-shadow: 6px 6px 0px var(--secondary);
        }

        .btn-cancel {
            background: #EF4444;
            color: white;
            box-shadow: 4px 4px 0px var(--secondary);
        }

        .btn-cancel:hover {
            transform: translateY(-3px);
            box-shadow: 6px 6px 0px var(--secondary);
        }

        .loading {
            text-align: center;
            padding: 3rem;
            font-family: 'Bangers', cursive;
            font-size: 2rem;
            color: var(--secondary);
        }

        .back-to-top {
            position: fixed;
            bottom: 2rem;
            left: 2rem;
            width: 60px;
            height: 60px;
            background: var(--card-bg);
            border: 4px solid var(--secondary);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-family: 'Bangers', cursive;
            font-size: 2rem;
            color: var(--secondary);
            box-shadow: 5px 5px 0px var(--secondary);
            transition: all 0.3s ease;
            z-index: 100;
            opacity: 0;
            pointer-events: none;
        }

        .back-to-top.visible {
            opacity: 1;
            pointer-events: all;
        }

        .back-to-top:hover {
            transform: translateY(-5px) scale(1.1);
            box-shadow: 8px 8px 0px var(--secondary);
        }

        @media (max-width: 768px) {
            .grid {
                grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
                gap: 1.5rem;
            }

            .stats {
                gap: 1rem;
            }

            .stat-box {
                padding: 0.8rem 1.5rem;
            }
            
            .back-to-top {
                bottom: 1rem;
                left: 1rem;
                width: 50px;
                height: 50px;
            }
        }
    </style>
</head>
<body class="regular">
    <div class="container">
        <header>
            <img src="Pocket_tracker_logo.png" alt="Donald Duck Pocket Tracker" onerror="this.src='Pocket_tracker_logo.jpg'">
        </header>

        <div class="collection-nav">
            <div class="nav-arrow" id="prev-collection">‚Üê</div>
            <div class="collection-title" id="collection-name">Regular Pockets</div>
            <div class="nav-arrow" id="next-collection">‚Üí</div>
        </div>

        <div class="stats">
            <div class="stat-box">
                <span class="stat-number" id="total-count">0</span>
                <span class="stat-label">Total Pockets</span>
            </div>
            <div class="stat-box checked">
                <span class="stat-number" id="collected-count">0</span>
                <span class="stat-label">Collected</span>
            </div>
            <div class="stat-box buy-cheap">
                <span class="stat-number" id="buy-cheap-count">0</span>
                <span class="stat-label">Buy When Cheap</span>
            </div>
            <div class="stat-box">
                <span class="stat-number" id="remaining-count">0</span>
                <span class="stat-label">To Find</span>
            </div>
        </div>

        <div class="jump-container">
            <div class="jump-box">
                <label for="jump-input" style="font-size: 1.3rem; font-weight: bold; color: var(--text); margin-right: 1rem;">Jump to:</label>
                <input 
                    type="text" 
                    id="jump-input" 
                    class="jump-input"
                    placeholder="e.g. 42"
                >
                <button id="jump-button" class="jump-button">Go! üîç</button>
            </div>
        </div>

        <div id="grid" class="grid">
            <div class="loading">Loading your collection...</div>
        </div>
    </div>

    <div class="back-to-top" id="back-to-top" title="Back to top">‚Üë</div>

    <div id="confirm-clear-modal" class="modal">
        <div class="modal-content">
            <div class="modal-title">Are you sure?</div>
            <div class="modal-text">You're about to remove the status of <strong id="confirm-clear-name"></strong>. This can't be undone!</div>
            <div class="modal-buttons">
                <button class="btn" id="btn-confirm-clear" style="background: #94A3B8; color: white; box-shadow: 4px 4px 0px var(--secondary);">Yes, clear it</button>
                <button class="btn btn-cancel" id="btn-cancel-clear">No, go back</button>
            </div>
        </div>
    </div>

    <div id="modal" class="modal">
        <div class="modal-content">
            <div class="modal-title" id="modal-title">Pocket #<span id="modal-pocket-number"></span></div>
            <div class="modal-text">What's the status of this pocket?</div>
            <div class="modal-buttons">
                <button class="btn btn-confirm" id="btn-collected">‚úì I Have It!</button>
                <button class="btn" id="btn-buy-cheap" style="background: #F59E0B; color: white; box-shadow: 4px 4px 0px var(--secondary);">$ Buy When Cheap</button>
                <button class="btn" id="btn-none" style="background: #94A3B8; color: white; box-shadow: 4px 4px 0px var(--secondary);">Clear Status</button>
                <button class="btn btn-cancel" id="btn-cancel">Cancel</button>
            </div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getDatabase, ref, set, get, onValue } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js';

        const firebaseConfig = {
            apiKey: "AIzaSyA5lvEpzKwfIXOqDvYfkor0jHKb_LJA1vY",
            authDomain: "ddpt-bad7c.firebaseapp.com",
            databaseURL: "https://ddpt-bad7c-default-rtdb.europe-west1.firebasedatabase.app",
            projectId: "ddpt-bad7c",
            storageBucket: "ddpt-bad7c.firebasestorage.app",
            messagingSenderId: "21566768227",
            appId: "1:21566768227:web:dbdd3f8b664a8af846a456"
        };

        let app, database;
        try {
            app = initializeApp(firebaseConfig);
            database = getDatabase(app);
        } catch (error) {
            console.error("Firebase initialization error:", error);
        }

        // Collection definitions
        const collections = [
            {
                id: 'regular',
                name: 'Regular Pockets',
                prefix: '',
                count: 373,
                theme: 'regular',
                halfPockets: [174.5, 190.5, 198.5, 202.5, 207.5, 214.5, 273.5]
            },
            {
                id: 'dubbel',
                name: 'Dubbelpockets',
                prefix: 'D',
                count: 101,
                theme: 'dubbel'
            },
            {
                id: 'thema',
                name: 'Themapockets',
                prefix: 'T',
                count: 68,
                theme: 'thema'
            },
            {
                id: 'classics',
                name: 'Classics',
                prefix: 'C',
                count: 9,
                theme: 'classics'
            },
            {
                id: 'duckburg',
                name: 'Duckburg',
                prefix: 'DB',
                count: 6,
                theme: 'duckburg'
            },
            {
                id: 'wereldreis',
                name: 'Wereldreis',
                prefix: 'W',
                count: 6,
                theme: 'wereldreis'
            },
            {
                id: 'fantasy',
                name: 'Fantasy',
                prefix: 'F',
                count: 6,
                theme: 'fantasy'
            },
            {
                id: 'galaxy',
                name: 'Galaxy',
                prefix: 'G',
                count: 6,
                theme: 'galaxy'
            },
            {
                id: 'premium',
                name: 'Premium',
                prefix: 'P',
                count: 34,
                theme: 'premium'
            },
            {
                id: 'history',
                name: 'History',
                prefix: 'H',
                count: 8,
                theme: 'history'
            },
            {
                id: 'duckstad',
                name: 'Duckstad',
                prefix: 'DS',
                count: 11,
                theme: 'duckstad'
            },
            {
                id: 'mini',
                name: 'Mini',
                prefix: 'MN',
                count: 11,
                theme: 'mini'
            },
            {
                id: 'mega',
                name: 'Mega',
                prefix: 'MG',
                count: 11, // zomer 13-18 (6) + winter 13-15 (3) = 9, but you said 11 total
                theme: 'mega',
                special: ['Z13', 'Z14', 'Z15', 'Z16', 'Z17', 'Z18', 'W13', 'W14', 'W15'] // Special naming
            }
        ];

        let currentCollectionIndex = 0;
        let pocketData = {};
        let pendingToggle = null;

        function getCurrentCollection() {
            return collections[currentCollectionIndex];
        }

        function generatePocketNumbers(collection) {
            if (collection.special) {
                // Mega has special naming
                return collection.special;
            }
            
            const pockets = [];
            for (let i = 1; i <= collection.count; i++) {
                pockets.push(i);
            }
            
            // Add half pockets for regular collection
            if (collection.halfPockets) {
                collection.halfPockets.forEach(hp => {
                    pockets.push(hp);
                });
                pockets.sort((a, b) => a - b);
            }
            
            return pockets;
        }

        function getStorageKey(collection, num) {
            // Convert numbers to storage-safe format
            if (typeof num === 'number' && num % 1 !== 0) {
                // Half pocket: 174.5 -> 174_5
                return `${collection.id}_${String(num).replace('.', '_')}`;
            }
            return `${collection.id}_${num}`;
        }

        function getImageName(collection, num) {
            if (collection.id === 'regular') {
                // Regular pockets: check if half pocket
                if (typeof num === 'number' && num % 1 !== 0) {
                    // Half pocket: 174.5 -> 174h.jpg
                    return `${Math.floor(num)}h.jpg`;
                }
                // Regular: 1 -> 001.jpg
                return `${String(num).padStart(3, '0')}.jpg`;
            } else if (collection.id === 'mega') {
                // Mega: Z13, W14, etc. -> MGZ13.jpg, MGW14.jpg
                return `${collection.prefix}${num}.jpg`;
            } else {
                // Other collections: D001.jpg, T001.jpg, etc.
                return `${collection.prefix}${String(num).padStart(3, '0')}.jpg`;
            }
        }

        function getDisplayName(collection, num) {
            if (collection.id === 'regular') {
                return `Pocket #${num}`;
            } else if (collection.id === 'mega') {
                return `Mega ${num}`;
            } else if (collection.id === 'classics') {
                return `Classics #${num}`;
            } else {
                // Remove 's' from end of name for "pockets" collections
                let singularName = collection.name;
                if (singularName.toLowerCase().endsWith('pockets')) {
                    singularName = singularName.slice(0, -1); // Remove just the 's'
                }
                return `${singularName} #${num}`;
            }
        }

        async function initDatabase() {
            if (!database) {
                console.error("Database not initialized");
                return;
            }

            const collectionId = getCurrentCollection().id;
            const dataRef = ref(database, `collections/${collectionId}`);
            
            onValue(dataRef, (snapshot) => {
                const data = snapshot.val();
                if (data) {
                    pocketData = data;
                } else {
                    pocketData = {};
                }
                renderPockets();
                updateStats();
            }, (error) => {
                console.error('Firebase read error:', error);
            });
        }

        async function saveData() {
            if (!database) return;
            const collectionId = getCurrentCollection().id;
            const dataRef = ref(database, `collections/${collectionId}`);
            try {
                await set(dataRef, pocketData);
            } catch (error) {
                console.error('Error saving data:', error);
                alert('Error saving data: ' + error.message);
            }
        }

        function switchCollection(direction) {
            currentCollectionIndex += direction;
            if (currentCollectionIndex < 0) currentCollectionIndex = collections.length - 1;
            if (currentCollectionIndex >= collections.length) currentCollectionIndex = 0;
            
            const collection = getCurrentCollection();
            document.getElementById('collection-name').textContent = collection.name;
            document.body.className = collection.theme;
            
            initDatabase();
        }

        function togglePocket(storageKey, displayName) {
            pendingToggle = { key: storageKey, display: displayName };
            document.getElementById('modal-pocket-number').textContent = displayName;
            document.getElementById('modal').classList.add('active');
        }

        async function setPocketStatus(status) {
            if (pendingToggle !== null) {
                pocketData[pendingToggle.key] = status;
                await saveData();
                closeModal();
            }
        }

        function closeModal() {
            document.getElementById('modal').classList.remove('active');
            pendingToggle = null;
        }

        function renderPockets() {
            const grid = document.getElementById('grid');
            grid.innerHTML = '';

            const collection = getCurrentCollection();
            const pocketNumbers = generatePocketNumbers(collection);

            pocketNumbers.forEach((num, index) => {
                const storageKey = getStorageKey(collection, num);
                const state = pocketData[storageKey] || 'none';
                const card = document.createElement('div');
                let cardClass = 'pocket-card';
                if (state === 'collected') cardClass += ' checked';
                if (state === 'buy-cheap') cardClass += ' buy-cheap';
                
                card.className = cardClass;
                card.style.animationDelay = `${index * 0}s`;
                
                const imageName = getImageName(collection, num);
                const displayName = getDisplayName(collection, num);
                
                let statusLabel = 'Need it';
                if (state === 'collected') statusLabel = 'Got it!';
                if (state === 'buy-cheap') statusLabel = 'Buy cheap';
                
                card.innerHTML = `
                    <div class="image-container">
                        <img 
                            src="${imageName}" 
                            alt="${displayName}"
                            class="pocket-image"
                            onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';"
                        >
                        <div class="placeholder-image" style="display: none;">
                            ${collection.prefix}${num}
                        </div>
                    </div>
                    <div class="pocket-title">${displayName}</div>
                    <div class="checkbox-container">
                        <div class="custom-checkbox">
                            ${state === 'collected' ? '‚úì' : state === 'buy-cheap' ? '$' : ''}
                        </div>
                        <span class="checkbox-label">${statusLabel}</span>
                    </div>
                `;

                card.addEventListener('click', () => togglePocket(storageKey, displayName));
                grid.appendChild(card);
            });
        }

        function updateStats() {
            const collection = getCurrentCollection();
            const pocketNumbers = generatePocketNumbers(collection);
            const total = pocketNumbers.length;
            
            let collected = 0;
            let buyCheap = 0;
            
            pocketNumbers.forEach(num => {
                const key = getStorageKey(collection, num);
                if (pocketData[key] === 'collected') collected++;
                if (pocketData[key] === 'buy-cheap') buyCheap++;
            });
            
            const remaining = total - collected - buyCheap;

            document.getElementById('total-count').textContent = total;
            document.getElementById('collected-count').textContent = collected;
            document.getElementById('buy-cheap-count').textContent = buyCheap;
            document.getElementById('remaining-count').textContent = remaining;
        }

        function jumpToPocket() {
            const input = document.getElementById('jump-input');
            let searchValue = input.value.trim();
            
            if (!searchValue) return;
            
            const collection = getCurrentCollection();
            const cards = document.querySelectorAll('.pocket-card');
            let foundCard = null;
            
            // Build the expected display name
            let searchName;
            if (collection.id === 'regular') {
                searchName = `Pocket #${searchValue}`;
            } else if (collection.id === 'mega') {
                searchName = `Mega ${searchValue}`;
            } else if (collection.id === 'classics') {
                searchName = `Classics #${searchValue}`;
            } else {
                let singularName = collection.name;
                if (singularName.toLowerCase().endsWith('pockets')) {
                    singularName = singularName.slice(0, -1);
                }
                searchName = `${singularName} #${searchValue}`;
            }
            
            cards.forEach(card => {
                const title = card.querySelector('.pocket-title').textContent;
                if (title === searchName) {
                    foundCard = card;
                }
            });
            
            if (foundCard) {
                foundCard.scrollIntoView({ behavior: 'smooth', block: 'center' });
                foundCard.style.transform = 'scale(1.1) rotate(0deg)';
                foundCard.style.boxShadow = '0 0 30px rgba(2, 132, 199, 0.6)';
                
                setTimeout(() => {
                    foundCard.style.transform = '';
                    foundCard.style.boxShadow = '';
                }, 2000);
                
                input.value = '';
            } else {
                alert(`Pocket #${searchValue} not found in ${collection.name}.`);
            }
        }

        // Event listeners
        document.getElementById('btn-collected').addEventListener('click', () => setPocketStatus('collected'));
        document.getElementById('btn-buy-cheap').addEventListener('click', () => setPocketStatus('buy-cheap'));
        document.getElementById('btn-none').addEventListener('click', () => {
            // Show confirmation modal instead of clearing immediately
            document.getElementById('confirm-clear-name').textContent = pendingToggle.display;
            document.getElementById('modal').classList.remove('active');
            document.getElementById('confirm-clear-modal').classList.add('active');
        });
        document.getElementById('btn-cancel').addEventListener('click', closeModal);
        document.getElementById('modal').addEventListener('click', (e) => {
            if (e.target.id === 'modal') {
                closeModal();
            }
        });

        // Confirm clear modal
        document.getElementById('btn-confirm-clear').addEventListener('click', () => {
            setPocketStatus('none');
            document.getElementById('confirm-clear-modal').classList.remove('active');
        });
        document.getElementById('btn-cancel-clear').addEventListener('click', () => {
            document.getElementById('confirm-clear-modal').classList.remove('active');
        });
        document.getElementById('confirm-clear-modal').addEventListener('click', (e) => {
            if (e.target.id === 'confirm-clear-modal') {
                document.getElementById('confirm-clear-modal').classList.remove('active');
            }
        });

        document.getElementById('prev-collection').addEventListener('click', () => switchCollection(-1));
        document.getElementById('next-collection').addEventListener('click', () => switchCollection(1));
        
        document.getElementById('jump-button').addEventListener('click', jumpToPocket);
        document.getElementById('jump-input').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                jumpToPocket();
            }
        });

        // Back to top button
        const backToTopButton = document.getElementById('back-to-top');
        
        window.addEventListener('scroll', () => {
            if (window.scrollY > 300) {
                backToTopButton.classList.add('visible');
            } else {
                backToTopButton.classList.remove('visible');
            }
        });
        
        backToTopButton.addEventListener('click', () => {
            window.scrollTo({ top: 0, behavior: 'smooth' });
        });

        // Initialize
        initDatabase();
    </script>
</body>
</html>
